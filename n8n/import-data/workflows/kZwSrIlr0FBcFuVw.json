{
  "createdAt": "2025-09-26T14:50:35.529Z",
  "updatedAt": "2025-09-28T12:31:56.008Z",
  "id": "kZwSrIlr0FBcFuVw",
  "name": "test_n8n",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {
          "download": true,
          "chatIds": "104350862",
          "userIds": "104350862"
        }
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -416,
        -48
      ],
      "id": "c10c94d0-141c-464d-a338-86af4b1c6157",
      "name": "Telegram Trigger",
      "webhookId": "6640a14b-5697-4a23-9d4f-7c2af443d0df",
      "credentials": {
        "telegramApi": {
          "id": "jXDOrBeZepPh1O5z",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "type": "SHA256",
        "binaryData": true,
        "dataPropertyName": "=sha256_checksum"
      },
      "type": "n8n-nodes-base.crypto",
      "typeVersion": 1,
      "position": [
        336,
        48
      ],
      "id": "8436ffca-efbc-4e63-9e40-5aea11e75c1c",
      "name": "Crypto"
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "={{ $json.message.document.file_name }}",
        "returnAll": true,
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "=1JasKxZmeWERdFwsj1zAsbxdqniYjX7Ax",
            "mode": "id"
          }
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        112,
        -144
      ],
      "id": "e048d74d-ae40-4d40-bdd2-9cb0fa1cb9d9",
      "name": "Search files and folders",
      "alwaysOutputData": true,
      "notesInFlow": false,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "JqSzUPdshsottef3",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "operation": "write",
        "fileName": "=/tmp/{{ $json.update_id }}_{{ $binary.data.fileName }}",
        "options": {
          "append": false
        }
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [
        96,
        48
      ],
      "id": "2e3888d9-fc1e-4386-a7af-cfb618d0dbd4",
      "name": "Read/Write Files from Disk"
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "={{ $json.id }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        272,
        -144
      ],
      "id": "3a72c8e1-5b18-4d28-86cf-81ec27bc9273",
      "name": "Download file",
      "alwaysOutputData": false,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "JqSzUPdshsottef3",
          "name": "Google Drive account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "type": "SHA256",
        "binaryData": true,
        "dataPropertyName": "=sha256_checksum"
      },
      "type": "n8n-nodes-base.crypto",
      "typeVersion": 1,
      "position": [
        432,
        -144
      ],
      "id": "6f7ad674-f253-4819-965e-5739434b50db",
      "name": "Crypto1",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "mergeByFields": {
          "values": [
            {
              "field1": "sha256_checksum",
              "field2": "sha256_checksum"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.compareDatasets",
      "typeVersion": 2.3,
      "position": [
        784,
        -80
      ],
      "id": "6e5b139b-0b51-4133-a598-7ac3ef37b56b",
      "name": "Compare Datasets"
    },
    {
      "parameters": {
        "jsCode": "return [\n  { \n    filename: $input.first().json.name,\n    sha256_checksum: $input.first().json.sha256_checksum\n  }\n]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        592,
        -144
      ],
      "id": "212f0c27-c9e2-4825-b0b3-abf05a2cfe4a",
      "name": "Code in JavaScript",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "fileSelector": "={{ $json.fileName }}",
        "options": {}
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [
        1024,
        0
      ],
      "id": "39e9b881-9b50-45b7-815c-5af89418e742",
      "name": "Read/Write Files from Disk1"
    },
    {
      "parameters": {
        "name": "={{ $('Information Extractor').item.json.output[0].output.titolo.replaceAll(' ','_').replaceAll(':','').replaceSpecialChars() }}.{{ $binary.data.fileExtension }}",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "=1JasKxZmeWERdFwsj1zAsbxdqniYjX7Ax",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        2816,
        128
      ],
      "id": "6b2ae995-14af-4781-ac48-7c0083acc71d",
      "name": "Upload file",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "JqSzUPdshsottef3",
          "name": "Google Drive account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "434c9bdd-3852-4804-a05e-00ee39841bf3",
              "name": "source",
              "value": "GDrive",
              "type": "string"
            },
            {
              "id": "f98bac67-1d8f-4a73-a642-d99aa0329326",
              "name": "fileName",
              "value": "=slip_{{   $now.format('ddLLyyyyHHmm') }}.{{ $json.fileExtension }}",
              "type": "string"
            },
            {
              "id": "8f13ce04-3ab7-478e-98af-d8353eec478a",
              "name": "fileId",
              "value": "={{ $json.permissions[0].id }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1280,
        0
      ],
      "id": "49d6221d-60a5-496b-9039-6c26897bd0b0",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $binary.data.mimeType }}",
                    "rightValue": "^image/(jpg|jpeg|png)$",
                    "operator": {
                      "type": "string",
                      "operation": "regex"
                    },
                    "id": "559d6167-b784-4e0b-94be-8fc6a2bb3cd1"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "image"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "aafa2ba0-a9f0-45ff-82b4-e4166ab5d26b",
                    "leftValue": "={{ $binary.data.mimeType }}",
                    "rightValue": "application/pdf",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "pdf"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        944,
        384
      ],
      "id": "bf1d4bc8-4aaa-415a-8bba-03ca5a2f32e0",
      "name": "Switch"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.mistralAi",
      "typeVersion": 1,
      "position": [
        1168,
        480
      ],
      "id": "330d55ea-bfcc-43c8-8281-069f7ea18f88",
      "name": "Extract text PDF",
      "credentials": {
        "mistralCloudApi": {
          "id": "OiGDnJhYajdQp1Cb",
          "name": "Mistral Cloud account"
        }
      }
    },
    {
      "parameters": {
        "documentType": "image_url",
        "options": {}
      },
      "type": "n8n-nodes-base.mistralAi",
      "typeVersion": 1,
      "position": [
        1168,
        288
      ],
      "id": "1fd77592-19fa-46c9-93df-cedb0623c2c8",
      "name": "Extract text Image",
      "credentials": {
        "mistralCloudApi": {
          "id": "OiGDnJhYajdQp1Cb",
          "name": "Mistral Cloud account"
        }
      }
    },
    {
      "parameters": {
        "amount": 2
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        2368,
        416
      ],
      "id": "af3e7ce5-8994-4a62-9199-b2c59acab419",
      "name": "Wait",
      "webhookId": "4f8ce6b0-f70a-4fd2-a7e6-bb8ddfa2656b"
    },
    {
      "parameters": {
        "fieldToSplitOut": "pages",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        1472,
        400
      ],
      "id": "fd8a2413-192d-4b52-8640-a399b8a63165",
      "name": "Split Out"
    },
    {
      "parameters": {
        "batchSize": "=1",
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        1856,
        400
      ],
      "id": "c2ab869c-de5b-4091-9dd1-1febed13d6d7",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "text": "=Messaggio:\n{{ $('Telegram Trigger').item.json.message.caption }}\nLocandina:\n{{ $json.stdout }}",
        "schemaType": "fromJson",
        "jsonSchemaExample": "[\n  {\n    \"output\": {\n      \"titolo\": \"Evento Informativo Benessere e Sonno\",\n      \"data\": \"01/10/2025\",\n      \"ora\": \"20:15\",\n      \"dove\": \"Sala Associazione, Via Matteotti, 7, Gornate Olona\",\n      \"descrizione\": \"La ditta Ondatheraphy terrà un evento informativo sul benessere del sonno e i materassi, donando 340€ all'associazione Osteoarc per le sue attività.  Sarà offerto un ricco buffet e un omaggio alle coppie partecipanti (fino a 3 persone non in coppia, dai 30 ai 75 anni).  Si richiede puntualità e l'assenza di bambini.\",\n    \"contatto\": \"segreteria@osteoarc.it | 339 6392152\"\n    }\n  }\n]",
        "options": {
          "systemPromptTemplate": "You are an expert in effective communication and event description. Your role is to write clear, precise, and impactful event description, avoiding unnecessary words or ambiguity. Always focus on brevity, clarity, and accuracy, ensuring your explanations are professional, direct, and easy to understand.\nThe \"descrizione\" must be in Italian lang.\nAdd in the \"contato key\" this value: \"segreteria@osteoarc.it | 339 6392152\""
        }
      },
      "type": "@n8n/n8n-nodes-langchain.informationExtractor",
      "typeVersion": 1.2,
      "position": [
        2352,
        128
      ],
      "id": "74665ce4-f658-40fc-8e76-04d4c13f937e",
      "name": "Information Extractor"
    },
    {
      "parameters": {
        "model": "gemma3:4b",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmOllama",
      "typeVersion": 1,
      "position": [
        2304,
        304
      ],
      "id": "273ac9bc-7e23-4773-9150-6ced3202a67a",
      "name": "Ollama Model",
      "credentials": {
        "ollamaApi": {
          "id": "xHuYe0MDGOs9IpBW",
          "name": "Local Ollama service"
        }
      }
    },
    {
      "parameters": {
        "command": "=echo \"{{ $json.markdown }}\" \\\n| sed -E 's/!\\[.*\\]\\(.*\\)//g; s/\\*\\*//g; s/^#+[ ]*//g; s/^- //g; s/\\\\\"//g' \\\n| sed '/^[[:space:]]*$/d' \\\n| tr -s ' ' \\\n| tee -a /tmp/summarize.txt"
      },
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [
        2112,
        416
      ],
      "id": "4b86b006-b93f-4fa3-ba1e-6fe60a539b69",
      "name": "Execute Command1"
    },
    {
      "parameters": {
        "command": "=cat /tmp/summarize.txt"
      },
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [
        2160,
        128
      ],
      "id": "353cd276-0c0e-49d2-aa84-e03e1217ffc2",
      "name": "Execute Command2"
    },
    {
      "parameters": {
        "command": "=rm /tmp/*.*"
      },
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [
        4400,
        -336
      ],
      "id": "6fbfc9df-5292-4178-babb-7a34aaeacc77",
      "name": "Execute Command3",
      "alwaysOutputData": false,
      "retryOnFail": false
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "120RTjkIjOZdHoKUgyEIhMr1W4wsqsitrQXj_KTiKNTQ",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Foglio1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/120RTjkIjOZdHoKUgyEIhMr1W4wsqsitrQXj_KTiKNTQ/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "descrizione": "={{ $('Information Extractor').item.json.output[0].output.descrizione }}",
            "dove": "={{ $('Information Extractor').item.json.output[0].output.dove }}",
            "ora": "={{ $('Information Extractor').item.json.output[0].output.ora }}",
            "data": "={{ $('Information Extractor').item.json.output[0].output.data }}",
            "titolo": "={{ $('Information Extractor').item.json.output[0].output.titolo }}",
            "id_file": "={{ $json.id }}",
            "id": "={{ $json.sha256Checksum }}",
            "contatto": "={{ $('Information Extractor').item.json.output[0].output.contatto }}",
            "titolo_file": "={{ $json.name }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "titolo",
              "displayName": "titolo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "data",
              "displayName": "data",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "ora",
              "displayName": "ora",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "dove",
              "displayName": "dove",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "descrizione",
              "displayName": "descrizione",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "contatto",
              "displayName": "contatto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "id_file",
              "displayName": "id_file",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "titolo_file",
              "displayName": "titolo_file",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        3056,
        16
      ],
      "id": "49df7dc8-e0ec-44e9-9649-b64eb84c1718",
      "name": "Append or update row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "NxWaDBIk7Np1fizK",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "return $input.all()"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        592,
        48
      ],
      "id": "0ec58c44-534d-4fe2-bb3d-9131509e8b7d",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "chatId": "=104350862",
        "text": "File già esistente...",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1616,
        -240
      ],
      "id": "71fc390e-3777-4581-b7d6-c3c822aea502",
      "name": "Send a text message",
      "webhookId": "1595c6b3-e6f5-4b5e-99ea-41644cccc3d1",
      "credentials": {
        "telegramApi": {
          "id": "jXDOrBeZepPh1O5z",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "10646eae-ae46-4327-a4dc-9987c2d76173",
              "name": "file_id",
              "value": "={{ $json.id }}",
              "type": "string"
            },
            {
              "id": "dd0aa081-79e7-4714-8a67-1e898285554c",
              "name": "folder_id",
              "value": "={{ $json.parents[0] }}",
              "type": "string"
            },
            {
              "id": "49e61acb-a3c1-444e-9497-b600ab55c855",
              "name": "sha256Checksum",
              "value": "={{ $json.sha256Checksum }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "25271ac6-9cba-4083-a9dd-dd5a52f183fb",
      "name": "Set File ID",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3072,
        352
      ]
    },
    {
      "parameters": {
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "file_id",
                "value": "={{ $('Clear Old Vectors').item.json.file_id }}"
              },
              {
                "name": "folder_id",
                "value": "={{ $('Clear Old Vectors').item.json.folder_id }}"
              },
              {
                "name": "sha256Checksum",
                "value": "={{ $('Clear Old Vectors').item.json.sha256Checksum }}"
              }
            ]
          }
        }
      },
      "id": "f0c3c844-e5e7-467d-af4d-feaf57146b78",
      "name": "Default Data Loader",
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1,
      "position": [
        4432,
        640
      ]
    },
    {
      "parameters": {
        "chunkSize": 100,
        "options": {}
      },
      "id": "41e7408d-62e3-45f3-9de9-7b33a4fec7a7",
      "name": "Recursive Character Text Splitter1",
      "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        4416,
        848
      ]
    },
    {
      "parameters": {
        "model": "embeddinggemma:latest"
      },
      "id": "aa60e213-b73d-47a2-9c2a-da52351cdd73",
      "name": "Embeddings Ollama",
      "type": "@n8n/n8n-nodes-langchain.embeddingsOllama",
      "typeVersion": 1,
      "position": [
        4240,
        624
      ],
      "credentials": {
        "ollamaApi": {
          "id": "xHuYe0MDGOs9IpBW",
          "name": "Local Ollama service"
        }
      }
    },
    {
      "parameters": {
        "mode": "insert",
        "qdrantCollection": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "options": {
          "collectionConfig": ""
        }
      },
      "id": "f5cb12f8-aebd-44b7-bed9-1c158001ab00",
      "name": "Qdrant Vector Store Insert",
      "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
      "typeVersion": 1,
      "position": [
        4176,
        352
      ],
      "credentials": {
        "qdrantApi": {
          "id": "sFfERYppMeBnFNeA",
          "name": "Local QdrantApi database"
        }
      }
    },
    {
      "parameters": {
        "operation": "text",
        "options": {}
      },
      "id": "3d450603-0675-4305-88c2-7bbb7658a5b0",
      "name": "Extract Document Text",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        3968,
        352
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "code": {
          "execute": {
            "code": "const { QdrantVectorStore } = require(\"@langchain/qdrant\");\nconst { OllamaEmbeddings } = require(\"@langchain/community/embeddings/ollama\");\n\nconst embeddings = new OllamaEmbeddings({\n  model: \"embeddinggemma:latest\",\n  baseUrl: \"http://ollama:11434\"\n});\n\nconst vectorStore = await QdrantVectorStore.fromExistingCollection(\n  embeddings,\n  {\n    url: \"http://qdrant:6333\",\n    collectionName: \"documents\",\n  }\n);\n\nconst fileId = this.getInputData()[0].json.file_id;\nconst folderId = this.getInputData()[0].json.folder_id;\nconst sha256ChecksumToDelete = this.getInputData()[0].json.sha256Checksum;\n\nconst filter = {\n        must: [\n            {\n                key: \"metadata.sha256Checksum\",\n                match: {\n                    value: sha256ChecksumToDelete,\n                },\n            },\n        ],\n    }\n\n// const results = await vectorStore.similaritySearch(\"this\", 10, filter);\n// const idsToDelete = results.map((doc) => doc.id);\n\n// NOT IMPLEMENTED!\n// await vectorStore.delete({ ids: idsToDelete });\n\nvectorStore.client.delete(\"documents\", {\n  filter\n});\n\nreturn [ {json: {\n  file_id: fileId,\n  folder_id: folderId,\n  sha256Checksum: sha256ChecksumToDelete\n  }\n} ];\n"
          }
        },
        "inputs": {
          "input": [
            {
              "type": "main",
              "required": true
            }
          ]
        },
        "outputs": {
          "output": [
            {
              "type": "main"
            }
          ]
        }
      },
      "id": "97ae1d4b-98d9-43c8-a5e5-b04c4d37a63a",
      "name": "Clear Old Vectors",
      "type": "@n8n/n8n-nodes-langchain.code",
      "typeVersion": 1,
      "position": [
        3280,
        352
      ],
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "fileSelector": "=/tmp/summarize.txt",
        "options": {}
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [
        3744,
        352
      ],
      "id": "2a789746-1c4c-4bb1-896e-f9987298eb08",
      "name": "Read/Write Files from Disk4"
    },
    {
      "parameters": {
        "command": "=echo \"{{ $('Telegram Trigger').item.json.message.caption }}\" \\\n| sed -E 's/!\\[.*\\]\\(.*\\)//g; s/\\*\\*//g; s/^#+[ ]*//g; s/^- //g; s/\\\\\"//g' \\\n| sed '/^[[:space:]]*$/d' \\\n| tr -s ' ' \\\n| tee -a /tmp/summarize.txt"
      },
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [
        3504,
        352
      ],
      "id": "a14e3ead-7ac8-4423-b161-2e84fb45cca5",
      "name": "Execute Command"
    },
    {
      "parameters": {
        "chatId": "=104350862",
        "text": "File caricato",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        3344,
        -48
      ],
      "id": "8439515e-b36f-45bd-8c6f-cdedc7dc7f0f",
      "name": "Send a text message1",
      "webhookId": "1595c6b3-e6f5-4b5e-99ea-41644cccc3d1",
      "credentials": {
        "telegramApi": {
          "id": "jXDOrBeZepPh1O5z",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "sendAndWait",
        "chatId": "=104350862",
        "message": "=[{\n    \"titolo\": \"{{ $('Append or update row in sheet').item.json.titolo }}\",\n    \"data\": \"{{ $('Append or update row in sheet').item.json.data }}\",\n    \"ora\": \"{{ $('Append or update row in sheet').item.json.ora }}\",\n    \"dove\": \"{{ $('Append or update row in sheet').item.json.dove }}\",\n    \"descrizione\": \"{{ $('Append or update row in sheet').item.json.descrizione }}\",\n    \"contatto\": \"{{ $('Append or update row in sheet').item.json.contatto }}\"\n}]",
        "responseType": "customForm",
        "defineForm": "json",
        "jsonOutput": "=[\n  {\n    \"fieldLabel\": \"titolo\",\n    \"placeholder\": \"{{ $('Append or update row in sheet').item.json.titolo }}\",\n    \"requiredField\": true\n  },\n  {\n    \"fieldLabel\": \"data\",\n    \"placeholder\": \"{{ $('Append or update row in sheet').item.json.data }}\",\n    \"requiredField\": true\n  },\n  {\n    \"fieldLabel\": \"ora\",\n    \"placeholder\": \"{{ $('Append or update row in sheet').item.json.ora }}\",\n    \"requiredField\": true\n  },\n  {\n    \"fieldLabel\": \"dove\",\n    \"placeholder\": \"{{ $('Append or update row in sheet').item.json.dove }}\",\n    \"requiredField\": true\n  },\n  {\n    \"fieldLabel\": \"descrizione\",\n    \"placeholder\": \"{{ $('Append or update row in sheet').item.json.descrizione }}\",\n    \"requiredField\": true\n  },\n  {\n    \"fieldLabel\": \"contatto\",\n    \"placeholder\": \"{{ $('Append or update row in sheet').item.json.contatto }}\",\n    \"requiredField\": true\n  }\n]\n",
        "options": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        3584,
        -112
      ],
      "id": "bae6041e-a0f7-46b8-aab0-d6bf7f723202",
      "name": "Send message and wait for response",
      "webhookId": "1595c6b3-e6f5-4b5e-99ea-41644cccc3d1",
      "credentials": {
        "telegramApi": {
          "id": "jXDOrBeZepPh1O5z",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4542da18-a965-4210-9600-28da5e29265e",
              "name": "titolo",
              "value": "={{ $json.data.text.parseJson()[0].titolo }}",
              "type": "string"
            },
            {
              "id": "27fee4bf-1645-45fe-ac90-2fda81d243c1",
              "name": "data",
              "value": "={{ $json.data.text.parseJson()[0].data }}",
              "type": "string"
            },
            {
              "id": "ce0e6ea0-c94f-4025-a1e0-f04206b9e817",
              "name": "descrizione",
              "value": "={{ $json.data.text.parseJson()[0].descrizione }}",
              "type": "string"
            },
            {
              "id": "201f2ec3-584b-492f-95c4-2d35d6033b12",
              "name": "ora",
              "value": "={{ $json.data.text.parseJson()[0].ora }}",
              "type": "string"
            },
            {
              "id": "c97c0ad3-334d-4342-a260-02c1a98fa29f",
              "name": "dove",
              "value": "={{ $json.data.text.parseJson()[0].dove }}",
              "type": "string"
            },
            {
              "id": "6fed318a-02e7-4615-ba10-4746c337d951",
              "name": "contatto",
              "value": "={{ $json.data.text.parseJson()[0].contatto }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3792,
        -112
      ],
      "id": "882fedb0-0927-406a-9198-14297d9cfb3b",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "120RTjkIjOZdHoKUgyEIhMr1W4wsqsitrQXj_KTiKNTQ",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Foglio1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/120RTjkIjOZdHoKUgyEIhMr1W4wsqsitrQXj_KTiKNTQ/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "descrizione": "={{ $json.descrizione }}",
            "dove": "={{ $json.dove }}",
            "ora": "={{ $json.ora }}",
            "data": "={{ $json.data }}",
            "titolo": "={{ $json.titolo }}",
            "id": "={{ $('Append or update row in sheet').item.json.id }}",
            "contatto": "={{ $json.contatto }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "titolo",
              "displayName": "titolo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "data",
              "displayName": "data",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "ora",
              "displayName": "ora",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "dove",
              "displayName": "dove",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "descrizione",
              "displayName": "descrizione",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "contatto",
              "displayName": "contatto",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "id_file",
              "displayName": "id_file",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "titolo_file",
              "displayName": "titolo_file",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4048,
        -144
      ],
      "id": "89fc97ba-46e8-47ae-aa89-8c6651a9997b",
      "name": "Append or update row in sheet1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "NxWaDBIk7Np1fizK",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "fileSelector": "={{ $('Compare Datasets').item.json.fileName }}",
        "options": {}
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [
        2656,
        128
      ],
      "id": "a6b87f71-1400-45d0-a3a7-33e263ef26c2",
      "name": "Read/Write Files from Disk3"
    }
  ],
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Search files and folders",
            "type": "main",
            "index": 0
          },
          {
            "node": "Read/Write Files from Disk",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crypto": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read/Write Files from Disk": {
      "main": [
        [
          {
            "node": "Crypto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders": {
      "main": [
        [
          {
            "node": "Download file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download file": {
      "main": [
        [
          {
            "node": "Crypto1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Crypto1": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Compare Datasets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Compare Datasets": {
      "main": [
        [],
        [
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          }
        ],
        [],
        [
          {
            "node": "Read/Write Files from Disk1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read/Write Files from Disk1": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload file": {
      "main": [
        [
          {
            "node": "Append or update row in sheet",
            "type": "main",
            "index": 0
          },
          {
            "node": "Set File ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Extract text Image",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract text PDF",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract text Image": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract text PDF": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "Execute Command2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Execute Command1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Information Extractor": {
      "main": [
        [
          {
            "node": "Read/Write Files from Disk3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ollama Model": {
      "ai_languageModel": [
        [
          {
            "node": "Information Extractor",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Execute Command1": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute Command2": {
      "main": [
        [
          {
            "node": "Information Extractor",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append or update row in sheet": {
      "main": [
        [
          {
            "node": "Send a text message1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute Command3": {
      "main": [
        []
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Compare Datasets",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Send a text message": {
      "main": [
        [
          {
            "node": "Execute Command3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set File ID": {
      "main": [
        [
          {
            "node": "Clear Old Vectors",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader": {
      "ai_document": [
        [
          {
            "node": "Qdrant Vector Store Insert",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "Recursive Character Text Splitter1": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings Ollama": {
      "ai_embedding": [
        [
          {
            "node": "Qdrant Vector Store Insert",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Extract Document Text": {
      "main": [
        [
          {
            "node": "Qdrant Vector Store Insert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Clear Old Vectors": {
      "main": [
        [
          {
            "node": "Execute Command",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read/Write Files from Disk4": {
      "main": [
        [
          {
            "node": "Extract Document Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute Command": {
      "main": [
        [
          {
            "node": "Read/Write Files from Disk4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message1": {
      "main": [
        [
          {
            "node": "Send message and wait for response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send message and wait for response": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Append or update row in sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append or update row in sheet1": {
      "main": [
        [
          {
            "node": "Execute Command3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read/Write Files from Disk3": {
      "main": [
        [
          {
            "node": "Upload file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {
    "Append or update row in sheet": [
      {
        "json": {
          "descrizione": "Un promotore ONDA therapy parlerà di benessere del sonno e materassi. Donazione di 340€ per Osteoarc se si presentano 8 coppie o fino a 3 persone non in coppia dai 30 ai 75 anni. Buffet offerto.",
          "dove": "SALA ASSOCIAZIONE via VIA MATTEOTTI, 7 Gornate-Olona",
          "ora": "20:15",
          "data": "1 ottobre 2025",
          "titolo": "Evento informativo benessere del sonno",
          "id_file": "1wW58-YyjMP5KgZN_QK69NWeZznchYo5H",
          "id": "e062261747b250972faf6638fa8b98d5b377402d5b47d94f21dbdbe7178351d8",
          "contatto": "segreteria@osteoarc.it | 339 6392152",
          "titolo_file": "Evento_informativo_benessere_del_sonno.pdf"
        }
      }
    ]
  },
  "versionId": "d701f858-46a1-4c8d-9efc-7b393680ffef",
  "triggerCount": 1,
  "tags": [],
  "shared": [
    {
      "createdAt": "2025-09-27T13:57:29.726Z",
      "updatedAt": "2025-09-27T13:57:29.726Z",
      "role": "workflow:owner",
      "workflowId": "kZwSrIlr0FBcFuVw",
      "projectId": "G6CtU2rrwzyFRW0C",
      "project": {
        "createdAt": "2025-09-27T13:57:27.503Z",
        "updatedAt": "2025-09-27T14:15:16.505Z",
        "id": "G6CtU2rrwzyFRW0C",
        "name": "Filippo Di Marco <filidm5795@gmail.com>",
        "type": "personal",
        "icon": null,
        "description": null
      }
    }
  ]
}